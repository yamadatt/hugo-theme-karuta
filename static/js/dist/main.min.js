/*! Main JavaScript bundle (search, interactions) | Built: 2025-08-14T07:15:06.545Z */
document.addEventListener("DOMContentLoaded",function(){(function(){function l(t,e){return(e||document).querySelector(t)}const P=l("#search-open"),m=l("#search-modal");if(!m||!P)return;const d=l("#search-modal-input"),B=l("#search-form"),y=l("#search-results"),Q=l(".sm-backdrop",m),k=l("#search-count"),C=l("#search-loading"),A=l("#search-filter-toggle"),U=l("#search-filters"),K=l("#active-filters"),I=l("#sort-order"),E=l("#search-history"),S=l("#search-history-list"),N=l("#clear-history");let v=null,a="",H=null,w=null;const L={posts:!0,tags:!0,categories:!0,sortOrder:"relevance"},D="karuta-search-history",$=10;function T(){try{return JSON.parse(localStorage.getItem(D)||"[]")}catch(t){return[]}}function j(t){if(!t||t.length<2)return;let e=T();e=e.filter(function(n){return n!==t}),e.unshift(t),e.length>$&&(e=e.slice(0,$));try{localStorage.setItem(D,JSON.stringify(e)),O()}catch(n){}}function Z(t){let e=T();e=e.filter(function(n){return n!==t});try{localStorage.setItem(D,JSON.stringify(e)),O()}catch(n){}}function W(){try{localStorage.removeItem(D),O()}catch(t){}}function b(t){return(t==null?"":String(t)).replace(/[&<>"']/g,function(e){return{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"}[e]})}function O(){if(!S)return;const t=T();if(t.length===0){E&&(E.hidden=!0);return}const e=t.map(function(n){return'<div class="sm-history-item" data-query="'+b(n)+'"><span>'+b(n)+'</span><button class="sm-history-remove" data-query="'+b(n)+'" aria-label="\u524A\u9664">\xD7</button></div>'}).join("");S.innerHTML=e,E&&(E.hidden=!1)}function _(){const t=a.length>=2,e=T().length>0;t?(E&&(E.hidden=!0),y.style.display="block"):e?(O(),y.style.display="none"):(E&&(E.hidden=!0),y.style.display="block")}function X(){H=document.activeElement,d.focus(),w=function(t){if(t.key==="Enter"&&t.target===d){t.preventDefault(),t.stopPropagation(),a.length>=2&&j(a),d.focus();return}if(t.key==="Tab"){const e=Array.prototype.filter.call(m.querySelectorAll("a[href], button:not([disabled])"),function(r){return r.offsetParent!==null});if(e.length===0)return;const n=e[0],o=e[e.length-1];t.shiftKey&&document.activeElement===n?(t.preventDefault(),o.focus()):!t.shiftKey&&document.activeElement===o&&(t.preventDefault(),n.focus())}if(t.key==="ArrowDown"||t.key==="ArrowUp"){const e=y?y.querySelectorAll(".result"):null;if(!e||e.length===0)return;t.preventDefault();const n=document.activeElement;if(t.key==="ArrowDown"&&n===d){e[0].focus();return}if(t.key==="ArrowUp"&&n===d){e[e.length-1].focus();return}let o=-1;for(let i=0;i<e.length;i++)if(e[i]===n){o=i;break}let r=0;t.key==="ArrowDown"?r=o<e.length-1?o+1:0:r=o>0?o-1:e.length-1,e[r].focus()}},m.addEventListener("keydown",w)}function G(){w&&m&&(m.removeEventListener("keydown",w),w=null),H&&(H.focus(),H=null)}function q(){m.classList.add("open"),m.setAttribute("aria-hidden","false"),X(),_()}function J(){m.classList.remove("open"),m.setAttribute("aria-hidden","true"),y&&(y.innerHTML=""),k&&(k.textContent=""),C&&(C.hidden=!0),G()}function z(t){C&&(C.hidden=!t)}function tt(t){if(v&&!t)if(v.length&&typeof v[0].content=="undefined")v=null;else return Promise.resolve(v);function e(o){return fetch(o).then(function(r){return r.ok?r.json():[]}).catch(function(){return[]})}const n=Date.now();return Promise.all([e("/posts/index.json?v="+n),e("/index.json?v="+n)]).then(function(o){let r=[];for(let s=0;s<o.length;s++)Array.isArray(o[s])&&(r=r.concat(o[s]));r=r.filter(function(s){return s&&typeof s.permalink=="string"?s.permalink.indexOf("/posts/")!==-1:!1});const i=Object.create(null);return r=r.filter(function(s){const c=s.permalink||"";return i[c]?!1:(i[c]=!0,!0)}),r=r.map(function(s){return typeof s.content=="undefined"&&(s.content=s.summary||""),s}),v=r,v}).catch(function(){return v=[],v})}function p(t){return(t||"").toString().toLowerCase()}function et(t,e){const n=p(t.title),o=p(t.summary),r=p(t.content),i=p(t.description),s=[n,o,r,i,(t.tags||[]).join(" "),(t.categories||[]).join(" ")].join(" ");if(!e)return 0;const c=s.indexOf(e),f=n.startsWith(e)?5:0;return(c>=0?100-c:-1)+f}function nt(t,e){const n=p(t.title),o=p(t.summary),r=p(t.content);if(n.indexOf(e)>=0)return{text:t.title,type:"title",score:100};if(o.indexOf(e)>=0)return{text:t.summary,type:"summary",score:80};if(r.indexOf(e)>=0){const c=t.content,f=c.toLowerCase().indexOf(e),g=Math.max(0,f-75),h=Math.min(c.length,f+e.length+150);let u=c.substring(g,h);if(g>0){const x=u.search(/[。！？.!?]\s*/);x>0&&x<30?u=u.substring(x+1):u="..."+u}if(h<c.length){const x=u.lastIndexOf("\u3002");x>u.length-30&&x>0?u=u.substring(0,x+1):u=u+"..."}return{text:u,type:"content",score:60}}const i=(t.tags||[]).join(" ").toLowerCase(),s=(t.categories||[]).join(" ").toLowerCase();return i.indexOf(e)>=0||s.indexOf(e)>=0?{text:t.summary||t.title,type:"taxonomy",score:40}:{text:t.summary,type:"summary",score:20}}function rt(t){if(!t||t.length===0){y.innerHTML="<p>\u8A72\u5F53\u3059\u308B\u7D50\u679C\u304C\u3042\u308A\u307E\u305B\u3093\u3002</p>",k&&(k.textContent="0\u4EF6");return}function e(r){return r.replace(/[.*+?^${}()|[\\\]\\]/g,"\\$&")}function n(r,i,s){const c=b(r||""),f=(i||"").trim();if(f.length===0)return c;let g=f.split(/\s+/).filter(function(F){return F});const h=Object.create(null);g=g.filter(function(F){const Y=F.toLowerCase();return h[Y]?!1:(h[Y]=!0,!0)});const u=s==="title"?"hl-title":s==="taxonomy"?"hl-taxonomy":"hl",x=new RegExp("("+g.map(e).join("|")+")","gi");return c.replace(x,'<mark class="'+u+'">$1</mark>')}const o=t.map(function(r){const i=nt(r,a.toLowerCase()),s=n(r.title||"",a,"title"),c=r.date?'<div class="result-meta">'+r.date+"</div>":"",f=n(i.text,a,i.type),g=i.type==="title"?'<span class="match-badge match-title">\u30BF\u30A4\u30C8\u30EB</span>':i.type==="summary"?'<span class="match-badge match-summary">\u6982\u8981</span>':i.type==="content"?'<span class="match-badge match-content">\u672C\u6587</span>':i.type==="taxonomy"?'<span class="match-badge match-taxonomy">\u30BF\u30B0</span>':"";let h="";const u=typeof window.__DEFAULT_COVER=="string"&&window.__DEFAULT_COVER?window.__DEFAULT_COVER:"/img/default-cover.svg";return r.cover?h='<img class="result-cover" src="'+r.cover+'" alt="'+b(r.title)+'" loading="lazy" decoding="async">':h='<img class="result-cover" src="'+u+'" alt="'+b(r.title)+'" loading="lazy" decoding="async">','<a class="result" href="'+r.permalink+'">'+h+'<div class="result-content"><div class="result-title">'+s+g+"</div>"+c+'<div class="result-summary">'+f+"</div></div></a>"}).join("");y.innerHTML=o,k&&(k.textContent=t.length+"\u4EF6")}function ot(t,e){return t.filter(function(n){return!!L.posts})}function st(t,e){return t.sort(function(n,o){if(L.sortOrder==="date"){const r=new Date(n.item.date||0);return new Date(o.item.date||0)-r}else return L.sortOrder==="title"?(n.item.title||"").localeCompare(o.item.title||""):o.score-n.score})}function V(){const t=Object.values(L).filter(function(e,n){return n<3&&!e}).length;t>0?K.textContent=`${3-t}/3 \u30D5\u30A3\u30EB\u30BF\u30FC\u6709\u52B9`:K.textContent=""}function it(t,e,n){let r=0;const i=[];function s(){const c=Math.min(r+50,t.length);for(let f=r;f<c;f++){const g=t[f],h=et(g,e);h>=0&&i.push({item:g,score:h})}r=c,r<t.length?setTimeout(s,0):n(i)}s()}function M(t,e=!0){if(t.length<2){y.innerHTML="",k.textContent="",_();return}e&&j(a),z(!0),tt().then(function(n){it(n,t,function(o){o=ot(o,t),o=st(o,t),o=o.slice(0,100).map(function(r){return r.item}),rt(o),z(!1),_()})})}P.addEventListener("click",q),Q.addEventListener("click",J),document.addEventListener("keydown",function(t){t.key==="Escape"&&J()});let R=null;d.addEventListener("input",function(t){const e=p(t.target.value);a=t.target.value,R&&clearTimeout(R),R=setTimeout(function(){M(e,!1)},150)}),d.addEventListener("keydown",function(t){if(t.key==="Enter")return t.preventDefault(),t.stopPropagation(),a.length>=2&&j(a),d.focus(),!1}),d.addEventListener("keypress",function(t){if(t.key==="Enter")return t.preventDefault(),t.stopPropagation(),!1}),B&&B.addEventListener("submit",function(t){return t.preventDefault(),t.stopPropagation(),a.length>=2&&j(a),d.focus(),!1}),A&&U&&A.addEventListener("click",function(){const t=A.getAttribute("aria-expanded")==="true";A.setAttribute("aria-expanded",!t),U.hidden=t}),["filter-posts","filter-tags","filter-categories"].forEach(function(t,e){const n=l("#"+t);n&&n.addEventListener("change",function(){const o=["posts","tags","categories"];L[o[e]]=n.checked,V(),a.length>=2&&M(p(a))})}),I&&I.addEventListener("change",function(){L.sortOrder=I.value,a.length>=2&&M(p(a))}),N&&N.addEventListener("click",function(){W()}),S&&S.addEventListener("click",function(t){const e=t.target.closest(".sm-history-item"),n=t.target.closest(".sm-history-remove");if(n){t.preventDefault(),t.stopPropagation();const o=n.getAttribute("data-query");Z(o)}else if(e){const o=e.getAttribute("data-query");d.value=o,a=o,M(p(o),!0),d.focus()}}),V(),O()})()});

(function(){"use strict";function l(){const i=document.getElementById("search-modal"),t=document.getElementById("search-modal-input"),e=document.getElementById("search-results");!i||!t||!e||i.addEventListener("keydown",function(r){if(r.key==="ArrowDown"||r.key==="ArrowUp"){const n=e.querySelectorAll(".result");if(n.length===0)return;r.preventDefault();const o=document.activeElement;let a=-1;for(let s=0;s<n.length;s++)if(n[s]===o){a=s;break}let c;r.key==="ArrowDown"?c=a<n.length-1?a+1:0:c=a>0?a-1:n.length-1,n[c].focus()}if(r.key==="Escape"){const n=document.getElementById("search-modal");if(n&&!n.hidden&&n.classList.contains("open")){const o=n.querySelector(".sm-backdrop");o&&o.click()}}if(r.key==="Enter"&&r.target===t){const n=e.querySelector(".result");n&&n.click()}})}function d(){const i=document.getElementById("primary-nav");if(!i)return;const t=i.querySelectorAll("a, button");let e=0;t.forEach((r,n)=>{r.setAttribute("tabindex",n===0?"0":"-1")}),i.addEventListener("keydown",function(r){(r.key==="ArrowLeft"||r.key==="ArrowRight")&&(r.preventDefault(),t[e].setAttribute("tabindex","-1"),r.key==="ArrowRight"?e=(e+1)%t.length:e=e>0?e-1:t.length-1,t[e].setAttribute("tabindex","0"),t[e].focus()),r.key==="Home"&&(r.preventDefault(),t[e].setAttribute("tabindex","-1"),e=0,t[e].setAttribute("tabindex","0"),t[e].focus()),r.key==="End"&&(r.preventDefault(),t[e].setAttribute("tabindex","-1"),e=t.length-1,t[e].setAttribute("tabindex","0"),t[e].focus())}),t.forEach((r,n)=>{r.addEventListener("focus",function(){t[e].setAttribute("tabindex","-1"),e=n,r.setAttribute("tabindex","0")})})}function f(){const i=document.querySelector(".grid");if(!i)return;const t=i.querySelectorAll(".card-link");t.length!==0&&i.addEventListener("keydown",function(e){const r=document.activeElement;if(!r.classList.contains("card-link"))return;const n=Array.from(t).indexOf(r);let o=n;const c=window.getComputedStyle(i).gridTemplateColumns.split(" ").length;switch(e.key){case"ArrowRight":e.preventDefault(),o=Math.min(n+1,t.length-1);break;case"ArrowLeft":e.preventDefault(),o=Math.max(n-1,0);break;case"ArrowDown":e.preventDefault(),o=Math.min(n+c,t.length-1);break;case"ArrowUp":e.preventDefault(),o=Math.max(n-c,0);break;case"Home":e.preventDefault(),o=0;break;case"End":e.preventDefault(),o=t.length-1;break}o!==n&&t[o].focus()})}function m(){const i=document.querySelector(".skip-to-main");i&&i.addEventListener("click",function(t){t.preventDefault();const e=document.getElementById("main-content");e&&(e.setAttribute("tabindex","-1"),e.focus(),e.addEventListener("blur",function(){e.removeAttribute("tabindex")},{once:!0}))})}function b(i){const t=i.querySelectorAll('a[href], button:not([disabled]), textarea:not([disabled]), input:not([disabled]), select:not([disabled]), [tabindex]:not([tabindex="-1"])');if(t.length===0)return null;const e=t[0],r=t[t.length-1];function n(o){o.key==="Tab"&&(o.shiftKey?document.activeElement===e&&(o.preventDefault(),r.focus()):document.activeElement===r&&(o.preventDefault(),e.focus()))}return{activate:function(){i.addEventListener("keydown",n),e.focus()},deactivate:function(){i.removeEventListener("keydown",n)}}}function u(){l(),d(),f(),m();const i=document.getElementById("search-modal");if(i){const t=b(i);new MutationObserver(function(r){r.forEach(function(n){n.attributeName==="class"&&(i.classList.contains("open")?t&&t.activate():t&&t.deactivate())})}).observe(i,{attributes:!0})}}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",u):u()})();

(function(){"use strict";function m(e){document.readyState==="loading"?document.addEventListener("DOMContentLoaded",e):e()}function h(){const e=document.getElementById("scroll-to-top"),s=e==null?void 0:e.querySelector(".progress-ring-fill"),n=e==null?void 0:e.querySelector(".progress-text");if(!e)return;let t=!1;const l=138.23,c=document.querySelector("article.single")||document.querySelector(".content")||document.documentElement.scrollHeight>window.innerHeight*1.5;function o(){if(t)return;const r=window.pageYOffset,i=r>200;if(e.classList.toggle("visible",i),i&&c&&s&&n){const y=window.innerHeight,S=document.documentElement.scrollHeight-y,f=Math.min(r/S*100,100),d=Math.round(f);let a;d>=100?a=0:a=l-f/100*l,s.style.strokeDashoffset=a,n.textContent=d;const E=r>400;e.classList.toggle("show-progress",E),e.classList.toggle("completed",d>=100)}}function w(){if(!t)if(e.blur(),t=!0,e.style.pointerEvents="none","scrollBehavior"in document.documentElement.style)window.scrollTo({top:0,behavior:"smooth"}),setTimeout(()=>{t=!1,e.style.pointerEvents="auto",o()},800);else{const r=-window.scrollY/33.333333333333336,i=setInterval(()=>{window.scrollY!==0?window.scrollBy(0,r):(clearInterval(i),t=!1,e.style.pointerEvents="auto",o())},15)}}e.addEventListener("click",w);let u=null;function v(){u===null&&(u=requestAnimationFrame(()=>{o(),u=null}))}window.addEventListener("scroll",v,{passive:!0}),window.addEventListener("resize",o,{passive:!0}),o()}function g(){document.documentElement.style.scrollBehavior="smooth",document.addEventListener("click",e=>{var o;const s=e.target.closest('a[href^="#"]');if(!s)return;const n=s.getAttribute("href");if(n==="#"||n==="#top"){e.preventDefault(),window.scrollTo({top:0,behavior:"smooth"});return}const t=document.querySelector(n);if(!t)return;e.preventDefault();const l=((o=document.querySelector(".site-header"))==null?void 0:o.offsetHeight)||0,c=t.offsetTop-l-20;window.scrollTo({top:Math.max(0,c),behavior:"smooth"}),history.pushState&&history.pushState(null,null,n),t.setAttribute("tabindex","-1"),t.focus(),t.removeAttribute("tabindex")})}function p(){document.activeElement&&document.activeElement!==document.body&&document.activeElement.blur()}m(()=>{p(),h(),g()})})();

